# 尚硅谷 电商离线数仓6.0 P21

# 1.0 数据仓库

- ##### 数据仓库的核心功能 : 统计分析

  - ##### 框架 Spark MR Flink

- ##### 技术路线的选择 更多的使用Hive

  - Spark On Hive : Spark 解析SQL
  - Hive On Spark : Hive 解析SQL



> #### 统计分析的基本步骤

1. ##### 对接数据源

2. ##### 加工数据(ETL)

3. ##### 统计数据

4. ##### 分析数据



# 1.1 数据源

> ### 数据仓库应该设计一个自己的数据源，为了代替和补充数据库
>
> - ##### 数据存储应该是和数据库的同步的(汇总) 将历史数据也包含了

- ##### 数据仓库应该遵循 统计分析的基本步骤

- ##### 数据仓库的数据源是数据库



- ##### 数据源(数据存储) -> 数据源2

- ##### 数据源2 -> 加工数据

- ##### 加工数据 -> 统计数据

- ##### 统计数据 -> 分析数据

> ##### 如果将数据库(MySQL)之间作为数据仓库的数据源
>
> 1. ##### 业务数据库的数据存储为行式存储，而数据康库的要求是列式存储
>
>    - ##### 数据不能直接对接 : 行式数据转换为列式数据
>
> 2. ##### 业务数据库中存储的数据不是海量数据，但是数据仓库要求海量数据
>
>    - ##### 数据不能直接对接 : 数据量不够
>
> 3. ##### 数据仓库不是为了数据仓库服务的
>
>    - ##### 数据仓库在对接数据库时，会对数据库的性能造成影响



# 1.2 数据采集和数据仓库

> #### 对于数据源，加工数据，统计数据，分析数据都应该拥有自己独立的数据，各个阶段的数据保存下来

- ##### 数据仓库的数据源数据需要从数据库中周期性(天同步)

  - ##### 一般情况下，将这个同步过程，称之为采集

- > 数据采集的时候，如果想要将数据同步到数据仓库的数据源，就必须知道数据库中的表结构
  >
  > - 那么采集项目和数据仓库就存在耦合性

- ##### 实际开发中，需要将采集项目和数据仓库项目解耦合

- ##### 添加中间件 HDFS

  - ##### Hive实际不是表格，而是文件，只是为了数据操作方便使用了SQL文

- ##### 数据采集(MySQL -> 数据采集 -> HDFS)

  - ##### Flume 上传日志文件

  - ##### DataX Maxwell处理数据库文件

- ##### 采集的目的，是为了后期的统计分析

  - ##### 需求1 : 当前电商网站所有注册的用户的数量

  - ##### 需求2 : 当前电商网站最近1周的新增注册用户的数量 (纯SQL慢)

  ```hive
  select count(*) from t_user where regdate >= 10-05 and regdate <= 10-10
  ```

  



# 1.3 数据分类

1. ##### 业务数据（MySQL）

   - ##### 工作内容就是业务，比如用户在电商网站中登录、下单、支付等过程中，需要和网站后台数据库进行增删改查交互，产生的数据就是业务数据。（开发内容中涉及的业务）

2. ##### 用户行为数据（日志）

   - ##### 用户在使用产品过程中，*通过埋点收集与客户端产品交互*过程中产生的数据，并发往日志服务器进行保存。比如页面浏览、点击、停留、评论、点赞、收藏等。用户行为数据通常存储在日志文件中。

> ### 用户行为采集



# 1.4 技术选型

> ## 离线需求

- ##### 指标

  - ##### 统计哪些值

1. ##### 项目技术如何选型

2. ##### 框架发行版本如何选型

3. ##### 服务器使用物理机还是云主机

4. ##### 如何确认集群规模？

> 技术选型主要考虑因素 数据量大小、业务需求、行业内经验、技术成熟度、开发维护成本、总承包预算
>
> Kafka可以均衡速率



# 1.5 全量和增量

- ##### 全量数据同步(DataX)

  - ##### 表全部数据

- ##### 增量数据同步(Maxwell)

  - ##### 表的新增及变化的数据



# 1.6 用户行为和日志概述

- 用户行为日志内容
  - 本项目收集和分析的用户行为信息主要有页面浏览记录、动作记录、曝光记录、启动记录和错误记录。
- 页面浏览记录
  - 页面信息
- 动作记录
  - 动作记录，记录的是用户的业务操作行为。

- #### 数据同步的格式

  - ##### 用户行为日志数据

  - ##### JSON格式

- #### 两大类日志

  - #### 页面浏览类日志

    - common : 环境信息
    - actions : 动作信息
    - displays : 曝光信息
    - page : 页面信息
    - err : 错误信息
    - ts : 进入当前页面的时间戳 (毫秒)

  - #### APP启动日志

    - common : 环境信息
    - start : 启动信息
    - err : 错误信息
    - ts : 启动APP的时间戳(毫秒)13位

# 1.7 环境搭建

- Java安装

  - 上传压缩包
  - 解压并移动更名
  - 添加环境变量
  - 更新环境变量 source  /etc/profile
  - 分发java 并分发环境变量

  ```shell
  export JAVA_HOME=/opt/module/java
  export PATH=$PATH:$JAVA_HOME/bin
  ```

- 